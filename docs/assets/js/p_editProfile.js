!function(e){function r(r){for(var o,i,s=r[0],c=r[1],u=r[2],f=0,p=[];f<s.length;f++)i=s[f],Object.prototype.hasOwnProperty.call(n,i)&&n[i]&&p.push(n[i][0]),n[i]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(e[o]=c[o]);for(l&&l(r);p.length;)p.shift()();return a.push.apply(a,u||[]),t()}function t(){for(var e,r=0;r<a.length;r++){for(var t=a[r],o=!0,s=1;s<t.length;s++){var c=t[s];0!==n[c]&&(o=!1)}o&&(a.splice(r--,1),e=i(i.s=t[0]))}return e}var o={},n={3:0},a=[];function i(r){if(o[r])return o[r].exports;var t=o[r]={i:r,l:!1,exports:{}};return e[r].call(t.exports,t,t.exports,i),t.l=!0,t.exports}i.m=e,i.c=o,i.d=function(e,r,t){i.o(e,r)||Object.defineProperty(e,r,{enumerable:!0,get:t})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,r){if(1&r&&(e=i(e)),8&r)return e;if(4&r&&"object"==typeof e&&e&&e.__esModule)return e;var t=Object.create(null);if(i.r(t),Object.defineProperty(t,"default",{enumerable:!0,value:e}),2&r&&"string"!=typeof e)for(var o in e)i.d(t,o,function(r){return e[r]}.bind(null,o));return t},i.n=function(e){var r=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(r,"a",r),r},i.o=function(e,r){return Object.prototype.hasOwnProperty.call(e,r)},i.p="";var s=window.webpackJsonp=window.webpackJsonp||[],c=s.push.bind(s);s.push=r,s=s.slice();for(var u=0;u<s.length;u++)r(s[u]);var l=c;a.push([365,0]),t()}({2:function(e,r,t){"use strict";var o=t(1);r.a={apiUrl:"//damp-shore-91853.herokuapp.com",pg_urlParaObj:function(){location;var e=location.search,r={};""!==e&&e.split("?")[1].split("&").forEach((function(e){r[e.split("=")[0]]=e.split("=")[1]}));return r},noTokenKickPatch:"index.html",getCookieToken:function(){this.cookieToken=document.cookie.replace(/(?:(?:^|.*;\s*)token\s*\=\s*([^;]*).*$)|^.*$/,"$1")},checkLogIn:function(){var e=this.cookieToken,r=location.pathname.split("/"),t=r[r.length-1]=="".concat("index.html"),n="index.html"==r[r.length-1],a="register.html"==r[r.length-1];t||n||a||""==e&&(o.Notify.warning("Token 過期或登出，五秒後導回登入頁，請重新登入！"),setTimeout((function(){document.location.href="index.html"}),5e3))},signout:function(){document.cookie="token=; expires=; path=/",this.cookieToken="",o.Notify.success("完成登出"),this.checkLogIn()},getProfile:function(){var e=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t="".concat(this.apiUrl,"/user/profile?queryUser=").concat(r);return new Promise((function(r,n){axios.defaults.headers.common.Authorization="Bearer ".concat(e.cookieToken),axios.get(t).then((function(e){r(e.data)})).catch((function(e){n(e),console.log("err.request",e.request);var r=JSON.parse(e.request.response);console.log("profileApi err.request.response",r),o.Notify.failure("讀取個人資料發生錯誤，".concat(e.response.data.message,"，將在五秒後導向登入頁面！")),setTimeout((function(){document.location.href="index.html"}),5e3)}))}))}}},33:function(e,r,t){"use strict";function o(e,r){var t="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=function(e,r){if(!e)return;if("string"==typeof e)return n(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);"Object"===t&&e.constructor&&(t=e.constructor.name);if("Map"===t||"Set"===t)return Array.from(e);if("Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return n(e,r)}(e))||r&&e&&"number"==typeof e.length){t&&(e=t);var o=0,a=function(){};return{s:a,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){t=t.call(e)},n:function(){var e=t.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==t.return||t.return()}finally{if(c)throw i}}}}function n(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,o=new Array(r);t<r;t++)o[t]=e[t];return o}function a(e,r,t,o,n,a,i){try{var s=e[a](i),c=s.value}catch(e){return void t(e)}s.done?r(c):Promise.resolve(c).then(o,n)}var i=function(){var e,r=(e=regeneratorRuntime.mark((function e(r){var t,n,a,i,s,c,u,l,f,p=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.file,n=r.imageType,a=void 0===n?"":n,i=r.formData,s=void 0===i?new FormData:i,c="".concat(this.apiUrl,"/upload/image"),t){s.append("image",t,t.name),u=o(s.values());try{for(u.s();!(l=u.n()).done;)f=l.value,console.log("formData value -> ",f)}catch(e){u.e(e)}finally{u.f()}}else console.log("file",t);return e.abrupt("return",new Promise((function(e,r){axios({method:"post",url:c+"?type=".concat(a),headers:{"Content-Type":"multipart/form-data",Authorization:"Bearer ".concat(p.cookieToken)},data:s}).then((function(r){return e(r.data)})).catch((function(e){return r(e)}))})));case 5:case"end":return e.stop()}}),e,this)})),function(){var r=this,t=arguments;return new Promise((function(o,n){var i=e.apply(r,t);function s(e){a(i,o,n,s,c,"next",e)}function c(e){a(i,o,n,s,c,"throw",e)}s(void 0)}))});return function(e){return r.apply(this,arguments)}}();r.a={upload_img:i,fileThrowError:function(e){var r=e.msgStr,t=void 0===r?"":r,o=e.isThrow,n=void 0===o||o,a=new Error("發生錯誤：");if(a.message+="".concat(t," / fileName: ").concat(a.fileName),n)throw a}}},365:function(e,r,t){"use strict";t.r(r);var o=t(3),n=t(5),a=t(1),i=t(4),s=t(2),c=t(33);function u(e,r,t,o,n,a,i){try{var s=e[a](i),c=s.value}catch(e){return void t(e)}s.done?r(c):Promise.resolve(c).then(o,n)}function l(e){return function(){var r=this,t=arguments;return new Promise((function(o,n){var a=e.apply(r,t);function i(e){u(a,o,n,i,s,"next",e)}function s(e){u(a,o,n,i,s,"throw",e)}i(void 0)}))}}Object(i.b)(o.Loading),Object(i.d)(n.Report),Object(i.c)(a.Notify);var f,p;new Vue({el:"#app",data:{apiUrl:s.a.apiUrl,cookieToken:"",userData:{userName:"Member"},updataUserData:{},updatePassword:{newPassword:"",confirmNewPassword:""},errorMessage:{updatePassword:""}},methods:{getCookieToken:s.a.getCookieToken,checkLogIn:s.a.checkLogIn,signout:s.a.signout,getProfile:s.a.getProfile,upload_img:c.a.upload_img,change_avatar:function(e){var r=e.imgUrl,t=e.imageType,o=e.file;this.updataUserData.avatarUrl=r,this.updataUserData.imageType=t,this.updataUserData.file=o},patchProfile:(p=l(regeneratorRuntime.mark((function e(){var r,t,n,i,s,c,u,l,f,p,d,g,h,m,v,y,b,w,k,x,P=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,r="".concat(this.apiUrl,"/user/profile"),t=this,o.Loading.custom("讀取中 ..."),n=this.updataUserData,i=n.avatarUrl,s=n.gender,c=n.userName,u=n.imageType,l=n.file,f={},f={gender:s,userName:c},p=null,i===t.userData.avatarUrl){e.next=17;break}return e.next=11,this.upload_img({imageType:u,file:l});case 11:p=e.sent,console.log("有使用 imgUrl 服務取得結果的 avatar_upload_img",p),f.avatarUrl=p.data,console.log("有使用 imgUrl 服務取得結果的 profileDataObj ->",f),e.next=19;break;case 17:a.Notify.warning("大頭照未更新。"),f.avatarUrl=i;case 19:return d=function(){return new Promise((function(e,t){axios.patch(r,f,{Authorization:"Bearer ".concat(P.cookieToken)}).then((function(r){a.Notify.success("修改個人資料更新成功！"),console.log("patchUserData axios ajax res.data.data",r.data.data),e(r.data.data)})).catch((function(e){t(e.response.data)}))}))},e.next=22,d();case 22:return g=e.sent,console.log("await_patchUserData",g),e.next=26,t.getProfile();case 26:(h=e.sent)&&(m=h.data,v=m._id,y=m.avatarUrl,b=m.email,w=m.gender,k=m.userName,x={_id:v,avatarUrl:y,email:b,gender:w,userName:k},t.userData=x,o.Loading.remove()),e.next=33;break;case 30:e.prev=30,e.t0=e.catch(0),console.log("patchProfile error",e.t0);case 33:case"end":return e.stop()}}),e,this,[[0,30]])}))),function(){return p.apply(this,arguments)}),update_password:function(){console.log("update_password");var e="".concat(this.apiUrl,"/user/update-password"),r=this;o.Loading.custom("讀取中 ...");var t=this.updatePassword,i=t.newPassword,s=t.confirmNewPassword;axios.patch(e,{newPassword:i,confirmNewPassword:s},{Authorization:"Bearer ".concat(this.cookieToken)}).then((function(e){console.log("res",e),r.updatePassword.newPassword="",r.updatePassword.confirmNewPassword="",o.Loading.remove(),n.Report.success("設定成功",'<p class="mb-0 text-center mt-n2">\n              重設密碼設定成功！\n            </p>',"確定")})).catch((function(e){var t=e.response.data;r.errorMessage.updatePassword=t.message,a.Notify.failure(r.errorMessage.updatePassword),o.Loading.remove()}))}},created:(f=l(regeneratorRuntime.mark((function e(){var r,t,n,a,i,s,c,u,l;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o.Loading.custom("讀取中 ..."),this.getCookieToken(),this.checkLogIn(),e.next=5,this.getProfile();case 5:(r=e.sent)&&(t=r.data,n=t._id,a=t.avatarUrl,i=t.email,s=t.gender,c=t.userName,u={_id:n,avatarUrl:a,email:i,gender:s,userName:c},this.userData=u,l={avatarUrl:a,gender:s,userName:c},this.updataUserData=l,o.Loading.remove());case 7:case"end":return e.stop()}}),e,this)}))),function(){return f.apply(this,arguments)})})},4:function(e,r,t){"use strict";t.d(r,"b",(function(){return n})),t.d(r,"a",(function(){return a})),t.d(r,"d",(function(){return i})),t.d(r,"c",(function(){return s}));var o={primary:{hex:"#03438D",overlay:"rgba(3, 67, 141, 0.9)"},success:{hex:"#83C51D",overlay:"rgba(131,197,29,0.2)"},failure:{hex:"#F57375",overlay:"rgba(245,115,117,0.2)"},warning:{hex:"#EEC32A",overlay:"rgba(238, 195, 42,0.2)"}},n=function(e){return e.init({svgSize:"150px",backgroundColor:o.primary.overlay,messageFontSize:"14px",customSvgUrl:"assets/static-images/MetaWall_logo.png"})},a=function(e){return e.init({titleColor:o.primary.hex,okButtonBackground:o.primary.hex,borderRadius:"8px",plainText:!1})},i=function(e){return e.init({borderRadius:"8px",svgSize:"40px",plainText:!1,success:{buttonBackground:o.success.hex,buttonColor:"#000",backOverlayColor:o.success.overlayColor},failure:{buttonBackground:o.failure.hex,buttonColor:"#fff",backOverlayColor:o.failure.overlayColor},warning:{buttonBackground:o.warning.hex,buttonColor:"#fff",backOverlayColor:o.warning.overlayColor}})},s=function(e){return e.init({borderRadius:"8px",timeout:4e3,messageMaxLength:110,backOverlay:!1,backOverlayColor:o.primary.overlay,plainText:!0,clickToClose:!1,pauseOnHover:!0,zindex:4001,fontSize:"15px",success:{notiflixIconColor:"rgba(0, 0, 0, .7)",background:o.success.hex,textColor:"#000",backOverlayColor:o.success.overlayColor},failure:{notiflixIconColor:"rgba(255, 255, 255, .7)",background:o.failure.hex,textColor:"#fff",backOverlayColor:o.failure.overlayColor},warning:{notiflixIconColor:"rgba(0, 0, 0, .7)",background:o.warning.hex,textColor:"#000",backOverlayColor:o.warning.overlayColor}})}}});